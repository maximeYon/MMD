#include "stdio.h"
#include "mdmrvec.h"

double array1[] = {0.0,-0.13954,-0.13634,-0.12969,-0.11907,-0.10357,-0.08173,-0.05129,-0.00871,0.05129,0.1356,0.24917,0.38271,0.50066,0.56857,0.59017,0.58772,0.57678,0.56429,0.55278,0.543,0.53502,0.52874,0.52397,0.52049,0.51806,0.51621,0.51402,0.50928,0.49651,0.46244,0.38168,0.2379,0.07321,-0.0559,-0.14132,-0.19661,-0.23362,-0.25954,-0.27848,-0.29285,-0.30409,-0.31311,-0.32051,-0.32666,-0.33182,-0.33612,-0.33961,-0.34219,-0.34358,-0.34314,-0.33948,-0.32967,-0.30758,0.0,0.0,-0.96131,-0.96295,-0.96624,-0.97117,-0.97766,-0.9854,-0.99357,-1.0,-0.99941,-0.97948,-0.91468,-0.76839,-0.53111,-0.26172,-0.02998,0.14382,0.27,0.3633,0.4349,0.4923,0.54044,0.58267,0.62143,0.6586,0.69578,0.73438,0.77544,0.81889,0.86059,0.88378,0.8437,0.68597,0.44798,0.23271,0.07811,-0.02643,-0.0973,-0.14606,-0.17981,-0.20285,-0.21781,-0.22623,-0.22899,-0.22644,-0.21852,-0.20476,-0.18416,-0.15505,-0.11476,-0.05908,0.01862,0.12847,0.28388,0.0,0.0,-0.24319,-0.23847,-0.22867,-0.21302,-0.19024,-0.15821,-0.11368,-0.05156,0.03571,0.15804,0.32251,0.5156,0.68556,0.78164,0.80841,0.79789,0.77276,0.74319,0.71276,0.68229,0.65147,0.6194,0.58482,0.54595,0.50024,0.44379,0.37041,0.26978,0.12486,-0.08836,-0.38109,-0.68963,-0.89257,-0.97235,-0.98826,-0.98152,-0.96886,-0.95605,-0.94491,-0.93585,-0.92888,-0.92386,-0.92064,-0.9191,-0.91917,-0.92078,-0.92384,-0.92822,-0.93355,-0.93888,-0.94188,-0.93678,-0.90969,0.0 };
double array2[] = {0.000000,-0.961310,-0.962950,-0.966240,-0.971170,-0.977660,-0.985400,-0.993570,-1.000000,-0.999410,-0.979480,-0.914680,-0.768390,-0.531110,-0.261720,-0.029980,0.143820,0.270000,0.363300,0.434900,0.492300,0.540440,0.582670,0.621430,0.658600,0.695780,0.734380,0.775440,0.818890,0.860590,0.883780,0.843700,0.685970,0.447980,0.232710,0.078110,-0.026430,-0.097300,-0.146060,-0.179810,-0.202850,-0.217810,-0.226230,-0.228990,-0.226440,-0.218520,-0.204760,-0.184160,-0.155050,-0.114760,-0.059080,0.018620,0.128470,0.283880,0.000000};

size_t array1_len = 165;
size_t array2_len = 55;

// Usage example

mdmr_dataset_b64* create_data() {
    // create dataset with 2 blocks
    mdmr_dataset* dataset = mdmr_create(2);

    // create block 0
    mdmr_define_block(dataset, 0, float64, array1_len);
    mdmr_define_block(dataset, 1, float64, array2_len);

    // initialize dataset
    mdmr_dataset* initset = mdmr_init(dataset);

    // check
    if (initset == NULL) {
        free(dataset);
        return NULL;
    }
    dataset = initset;

    // set data
    mdmr_set_block(dataset, 0, array1);
    mdmr_set_block(dataset, 1, array2);

    // generate base64
    //   get size of base64-encoded string with: dataset_b64->size
    //   get base64-encoded string (char[]) with: dataset_b64->data
    mdmr_dataset_b64* dataset_b64 = mdmr_dataset_as_b64(dataset);

    // clean up the working area
    free(dataset);

    return dataset_b64;
}

//==============================================================================

int main(int argc, char** argv) {

    mdmr_dataset_b64* dataset_b64 = create_data();

    printf("encoded size: %ld\n", dataset_b64->size);
    printf("encoded block:\n%s", dataset_b64->data);

    return 0;
}
