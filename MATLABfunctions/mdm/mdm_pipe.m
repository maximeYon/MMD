function fn = mdm_pipe(method, s, paths, opt)% function fn = mdm_pipe(method, s, paths, opt)%% Standard way of processing data -> fit -> param -> save niftiif (nargin < 3), paths = fileparts(s.nii_fn); endif (nargin < 4), opt.present = 1; endf_opt = @(opt) feval([method '_opt'], opt);f_check_xps = @(xps) feval([method '_check_xps'], xps);f_4d_data2fit = eval(['@' method '_4d_data2fit']);f_4d_fit2param = eval(['@' method '_4d_fit2param']);% Init structuresopt   = mdm_opt(opt);opt   = f_opt(opt);paths = mdm_paths(paths, method);msf_log(['Starting ' mfilename], opt);% Check that the xps is properf_check_xps(s.xps);% Fit and derive parametersmdm_data2fit(f_4d_data2fit, s, paths.mfs_fn, opt);mdm_fit2param(f_4d_fit2param, paths.mfs_fn, paths.dps_fn, opt);% Save niftisfn = mdm_param2nii(paths.dps_fn, paths.nii_path, opt.(method), opt); 