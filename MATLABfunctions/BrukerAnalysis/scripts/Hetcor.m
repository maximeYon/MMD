clear allwd = cd;CheckBasline = 0;AutoPhase = 0;PlotInterm = 0;MkReportFig = 1;SvSpecDataMat = 1;cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])ExpNam = {'210510_SC_Topgaard'};basl = [0.03 .15 .47 .53  .88 .97];lb = 50; si = 2*1024; ppmshift = 0;lb1 = 50; si1 = 1024; ppmshift1 = 0;AutoPhase = 0; pivot = 0.3779; phc0 = 115; phc1 = -150;expno = [28]; Imin = .1; Imax = 1; expno = [10:50];% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210429_SC_Topgaard'};% basl = [0.03 .12 .49 .53  .85 .97];% lb = 20; si = 2*1024; ppmshift = 0;% lb1 = 20; si1 = 512; ppmshift1 = 0;% pivot = 0.3794; phc0 = 105; phc1 = -120;% expno = [11]; Imin = .1; Imax = 1; expno = [5:9 11:18];% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/Simon/'])% ExpNam = {'POPC_GM3_AS_hetcor'};% basl = [0.02 .2 .8 .98];% lb = 100; si = 2*1024; ppmshift = 0;% lb1 = 100; si1 = 512; ppmshift1 = 0;% pivot = 0.3442; phc0 = -33.1041; phc1 = -89.5894;% expno = [73]; Imin = .1; Imax = 1; expno = [58:64 67:73];% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210422_SC_Topgaard'};% basl = [0.02 .1 .45 .53 .67 .72 .85 .98];% lb = 20; si = 2*1024; ppmshift = 0;% lb1 = 20; si1 = 512; ppmshift1 = 0;% expno = [57]; Imin = .01; Imax = 1; expno = [49 41 50 51 57];% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/SNC/DNP'])% ExpNam = {'210408_Lecithin_Topgaard'};% basl = [0.02 .2 .65 .7 .8 .98];% lb = 50; si = 2*1024; ppmshift = 0;% lb1 = 50; si1 = 512; ppmshift1 = 1.2 - (-7.194);% expno = [17:20]; Imin = .1; Imax = 1;% ppmmin = 0; ppmmax = 200; ppmmin1 = -2; ppmmax1 = 12;% cd(['/Users/daniel/Dropbox/NMRdata/AV4_500/daniel/'])% ExpNam = {'CPMAS_4mm_setup'};% basl = [0.01 .08 .5 .8 .9 .99];% lb = 10; si = 4*1024; ppmshift = 0;% lb1 = 10; si1 = 512; ppmshift1 = 0;% expno = 33; Imin = .1; Imax = 1;% % expno = 34; Imin = .12; Imax = 1;% expno = 45; Imin = .05; Imax = 1;% expno = 44; Imin = .1; Imax = 1;% cd(['/Users/daniel/NMRdata/AVII500/DT/'])%ExpNam = {'CPMAS4mm_setup'};% expno = 35:36;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% lb = 20;% si = 2*1024;% ppmshift = 0;% lb1 = 10;% si1 = 512;% ppmshift1 = 0;% % ExpNam = {'C10E4relax'};% expno = 26;% basl = [.02 .1 .14 .2 .37 .68 .72 .79 .86 .98];% lb = 2;% si = 32*1024;% ppmshift = 0;% lb1 = 5;% si1 = 2*512;% ppmshift1 = 0;% % ExpNam = {'C8G2RH97'};% expno = 33;% expno = 61;% basl = [.02 .1 .13 .18 .28 .50 .67 .82 .87 .98];% lb = 20;% si = 16*1024;% ppmshift = -.1;% lb1 = 10;% si1 = 1*512;% ppmshift1 = -2.6;% ExpNam = {'Efree4mm_setup'};% expno = 11;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% si = 4*1024; lb = 5;% si1 = 1024; lb1 = 5;% Imin = .05; Imax = 1;% expno = 24;% basl = [.02 .16 .2 .27 .47 .65 .69 .76 .79 .82 .85 .98];% si = 4*1024; lb = 5;% si1 = 1024; lb1 = 5; ppmshift1 = .9-2.98;% Imin = .05; Imax = 1;% ExpNam = {'Pstarch'};% expno = 49;% basl = [.05 .3 .6 .95];% si = 2*1024; lb = 50;% si1 = 64; lb1 = 20;% Imin = .1; Imax = 1;% ExpNam = {'Pstarch_hetcor'};% expno = 6:25; expno = 28:32;% basl = [.02 .08 .15 .3 .5 .8 .92 .98];% si = 4*1024; lb = 2;% si1 = 128; lb1 = 20;% Imin = .2; Imax = 1;cd(ExpNam{1})for nexp = 1:length(expno)    Spec2Dtd1            Icos = real(Itd1(:,1:2:(td1-1)));    Isin = real(Itd1(:,2:2:td1));    Icos(:,2:2:(td1/2)) = -Icos(:,2:2:(td1/2));    Isin(:,2:2:(td1/2)) = -Isin(:,2:2:(td1/2));    I = Icos + 1i*Isin;    Stemp = sum(I,1);    %figure(1), clf, plot(real(Stemp),'-o'), return    %figure(1), clf, plot(imag(Stemp),'-o'), return    if exist('lb1') == 0, lb1 = 0; end    lbfun1 = exp(-lb1*pi*t1);    Stemp = lbfun1.*Stemp;    %figure(1), clf, plot(t1,real(Stemp),t1,lbfun1*max(real(Stemp))), return    Stemp(1) = 0.5*Stemp(1);    Itemp = fftshift(fft(Stemp,si1));    %figure(1), clf, plot(real(Itemp)), return    Iproj1 = real(Itemp); Iproj1 = Iproj1/max(Iproj1);    Stemp1 = I;    [dummy,t1array] = ndgrid(1:si,t1);    lbfun1 = exp(-lb1*pi*t1array);    Stemp1 = lbfun1.*Stemp1;    Stemp(:,1) = 0.5*Stemp(:,1);    I = fftshift(fft(Stemp1,si1,2),2);    I = real(I);        %figure(1), clf, surf(I), view(0,90), shading('flat'), return    if exist('ppmmin') == 0        ppmmin = min(ppm);        ppmmax = max(ppm);        ppmmin1 = min(ppm1);        ppmmax1 = max(ppm1);    end    minI = Imin*max(max(I));    Iplot = I; %Iplot(find(Iplot<minI)) = minI;    Iplot = Iplot/max(max(Iplot));%        Iproj = max(I,[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));%        Iproj1 = max(I,[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));    Iproj = max(I(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));    Iproj1 = max(I(find(ppm>ppmmin&ppm<ppmmax),:),[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));    fs = 20;    lw = 1;        figure(1), clf    axes('position',[.2 .2 .6 .6],'FontSize',fs)    contour(ppm,ppm1,Iplot',logspace(log10(Imin),log10(Imax),10),'k','LineWidth',.5)    axis([ppmmin ppmmax ppmmin1 ppmmax1 -.05 1.02])    view(0,90), shading('interp')    set(gca,'XDir','reverse','YDir','reverse','YAxisLocation','right','TickDir','out','Box','on')    grid('off')    set(gca,'LineWidth',lw)    xlabel('\delta(^1^3C) / ppm','FontSize',fs)    ylabel('\delta(^1H) / ppm','FontSize',fs)    colormap('hot')    hold on    plot3([ppmmax ppmmin ppmmin], [ppmmax1 ppmmax1 ppmmin1], [1 1 1],'k-','LineWidth',lw)    hold off    axes('position',[.2 .81 .6 .19])    plot(ppm,Iproj,'k','LineWidth',lw)    set(gca,'XDir','reverse')    axis([ppmmin ppmmax -.02 1.02])    axis off    axes('position',[.0 .2 .2 .6])    plot(Iproj1,ppm1,'k','LineWidth',lw)    set(gca,'XDir','reverse','YDir','reverse')    axis([-.02 1.02 ppmmin1 ppmmax1])    axis off    if MkReportFig        delete([num2str(expno(nexp)) '/ReportFig.*'])        aspect = 1.6;        set(gcf, 'PaperUnits','centimeters','PaperPosition', 2*8.3*[0 0 1 1/aspect],'PaperSize', 2*8.3*[1 1/aspect]);        eval(['print -dpdf -loose ' num2str(expno(nexp)) '/ReportFig'])    end    if SvSpecDataMat        Spec.I = I;        Spec.ppm = ppm;        Spec.ppm1 = ppm1;        save([num2str(expno(nexp)) '/SpecDat.mat'],'Spec')    endendcd(wd)