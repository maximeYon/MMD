clear allMkReportFig=1;fignam = 'hetcor_multi.tex';data_path = '/Users/daniel/Dropbox/NMRdata/SNC/DNP';expnam = '210510_SC_Topgaard';Imin = .005; Imax = .25; expno = [10:18 20:23 25:48]; fignam = 'hetcor_multi.tex';ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;Imin = .15; Imax = 1; expno = [29:39]; fignam = 'hetcor_multi_sd.tex';ppmmin = 5; ppmmax = 85; ppmmin1 = -3; ppmmax1 = 11;Imin = .05; Imax = .35; expno = [40:48]; fignam = 'hetcor_multi_sd_long.tex';ppmmin = 5; ppmmax = 85; ppmmin1 = -3; ppmmax1 = 11;Imin = .05; Imax = .35; expno = [40:48]; fignam = 'hetcor_multi_sd_long_wide.tex';ppmmin = 5; ppmmax = 195; ppmmin1 = -3; ppmmax1 = 11;Imin = .005; Imax = .25; expno = [10:50]; fignam = 'hetcor_multi_expno.tex';ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% expnam = '210429_SC_Topgaard';% % Imin = .1; Imax = 1; expno = [8 6 5 7 9]; fignam = 'hetcor_5to9.tex';% Imin = .04; Imax = 1; expno = [11:17]; fignam = 'hetcor_11to17.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% data_path = '/Users/daniel/Dropbox/NMRdata/AV4_500/Simon/';% expnam = 'POPC_GM3_AS_hetcor';% Imin = .05; Imax = .5; expno = [58:64]; fignam = 'hetcor_58to64.tex';% Imin = .1; Imax = 1; expno = [67:73]; fignam = 'hetcor_67to73.tex';% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;% data_path = '/Users/daniel/Dropbox/NMRdata/SNC/DNP';% expnam = '210422_SC_Topgaard';% Imin = .005; Imax = .12; expno = [49 41 50 51 57];% ppmmin = -30; ppmmax = 230; ppmmin1 = -3; ppmmax1 = 13;aspect = 1.6;papersize = 2*8.3*[1 1/aspect];nexp = 1;spec_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'SpecDat.mat');load(spec_fn)I = Spec.I;ppm = Spec.ppm;ppm1 = Spec.ppm1;Iarray = zeros(size(I,1),size(I,2),numel(expno));for nexp = 1:length(expno)        spec_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'SpecDat.mat');    load(spec_fn)    Iarray(:,:,nexp) = Spec.I;    NMRacqus_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'NMRacqus.mat');    load(NMRacqus_fn)    d1_v(nexp) = NMRacqus.d1;    d8_v(nexp) = NMRacqus.d8;    p15_v(nexp) = NMRacqus.p15;endif exist('ppmmin') == 0    ppmmin = min(ppm);    ppmmax = max(ppm);    ppmmin1 = min(ppm1);    ppmmax1 = max(ppm1);end    maxI = max(Iarray(:));minI = Imin*maxI;fs = 12;lw = 1;for nexp = 1:length(expno)    I = Iarray(:,:,nexp);    Iplot = I; %Iplot(find(Iplot<minI)) = minI;    Iplot = Iplot/maxI;%        Iproj = max(I,[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));%        Iproj1 = max(I,[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));%     Iproj = max(I(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2); Iproj = Iproj/max(Iproj(find(ppm>ppmmin&ppm<ppmmax)));%     Iproj1 = max(I(find(ppm>ppmmin&ppm<ppmmax),:),[],1); Iproj1 = Iproj1/max(Iproj1(find(ppm1>ppmmin1&ppm1<ppmmax1)));    Iproj = max(Iplot(:,find(ppm1>ppmmin1&ppm1<ppmmax1)),[],2);    Iproj1 = max(Iplot(find(ppm>ppmmin&ppm<ppmmax),:),[],1);        figure(1), clf    axh_txt = axes('position',[0 0 1 1]);    t = text(0,1,{['expno = ' num2str(expno(nexp))];...        ['d1 = ' num2str(d1_v(nexp)) ' s'];...        ['p15 = ' sprintf('%4.0f',p15_v(nexp)) ' us'];...        ['d8 = ' num2str(d8_v(nexp)*1e3) ' ms']});    t.FontSize = fs; t.Units = 'normalized'; t.HorizontalAlignment = 'left'; t.VerticalAlignment = 'top';    axis(axh_txt,'off')    axes('position',[.2 .15 .7 .65],'FontSize',fs)    contour(ppm,ppm1,Iplot',logspace(log10(Imin),log10(Imax),20),'k','LineWidth',.1)    axis([ppmmin ppmmax ppmmin1 ppmmax1 -.05 1.02])    view(0,90), shading('interp')    set(gca,'XDir','reverse','YDir','reverse','YAxisLocation','right','TickDir','out','Box','on')    grid('off')    set(gca,'LineWidth',lw)    xlabel('\delta(^1^3C) / ppm','FontSize',fs)    ylabel('\delta(^1H) / ppm','FontSize',fs)    colormap('hot')    hold on    plot3([ppmmax ppmmin ppmmin], [ppmmax1 ppmmax1 ppmmin1], [1 1 1],'k-','LineWidth',lw)    hold off    axes('position',[.2 .81 .7 .19])    plot(ppm,Iproj,'k','LineWidth',lw)    set(gca,'XDir','reverse')    axis([ppmmin ppmmax Imax*[-.02 1.02]])    axis off    axes('position',[.0 .15 .2 .65])    plot(Iproj1,ppm1,'k','LineWidth',lw)    set(gca,'XDir','reverse','YDir','reverse')    axis([Imax*[-.02 1.02] ppmmin1 ppmmax1])    axis off    if MkReportFig        fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');%         delete(fig_fn)                set(gcf, 'PaperUnits','centimeters','PaperPosition', [0 0 papersize],'PaperSize', papersize);        print(fig_fn, '-dpdf', '-loose')    endpause(1)end%%figtex_fn = fullfile(data_path,expnam,fignam);fidtex = fopen(figtex_fn,'w');fprintf(fidtex,'%s\r','\documentclass{article}');fprintf(fidtex,'%s\r','\usepackage{geometry,graphicx, epstopdf}');fprintf(fidtex,'%s\r',['\geometry{papersize={' num2str(papersize(1)) 'cm,' num2str(papersize(2)) 'cm}, scale=1}']);fprintf(fidtex,'%s\r','\usepackage[abs]{overpic}');fprintf(fidtex,'%s\r\r','\setlength\unitlength{1in}');fprintf(fidtex,'%s\r\r','\begin{document}');for nexp = 1:length(expno)    fig_fn = fullfile(data_path,expnam,num2str(expno(nexp)),'ReportFig.pdf');    fprintf(fidtex,'%s\r','\begin{figure}');    fprintf(fidtex,'%s\r',['  \includegraphics[width=' num2str(papersize(1)) 'cm]{' fig_fn '}']);     fprintf(fidtex,'%s\r\r','\end{figure}');    fprintf(fidtex,'%s\r','\clearpage'); end    fprintf(fidtex,'%s\r','');fprintf(fidtex,'%s\r','\end{document}');fclose(fidtex);